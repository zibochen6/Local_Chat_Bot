# 🤖 集成语音对话助手使用说明

## 📋 功能概述

本语音助手集成了以下核心功能：
- **语音识别**: 基于sherpa-ncnn的实时语音转文本
- **智能问答**: 基于FAISS向量数据库的知识问答
- **语音合成**: 基于Kokoro TTS的高质量中文语音
- **唤醒词检测**: 支持"你好"唤醒词
- **智能对话管理**: 自动检测对话开始和结束

## 🚀 快速开始

### 1. 启动语音助手

```bash
cd /home/seeed/Local_Chat_Bot
source /home/seeed/miniforge3/etc/profile.d/conda.sh
conda activate chat
python integrated_voice_assistant.py
```

### 2. 使用流程

1. **等待唤醒**: 系统显示"🔄 监听唤醒词中..."
2. **说唤醒词**: 清晰地说"你好"
3. **等待回复**: 机器人会回复"你好呀，有什么问题可以问我。"
4. **提出问题**: 在机器人说完后，提出您的问题
5. **获得回答**: 系统会生成语音回答
6. **自动返回**: 回答完成后自动返回监听状态

## 🔧 技术特性

### 防回音设计
- **播放时暂停监听**: 机器人说话时自动停止语音识别
- **静音缓冲**: 播放完成后等待2秒让扬声器声音消散
- **音频阈值优化**: 提高语音检测阈值，减少噪音干扰
- **系统播放器**: 使用aplay替代pygame，避免音频重叠

### 智能对话管理
- **快速响应**: 检测到完整问题后1秒内结束监听
- **超时保护**: 8秒无语音自动结束对话
- **问题去重**: 防止重复处理同一个问题
- **状态管理**: 多线程安全的状态切换

### 音频优化
- **低延迟**: 512字节音频缓冲区
- **高质量**: 24kHz采样率，16位音频
- **临时文件管理**: 自动清理临时音频文件
- **静音模式**: aplay使用-q参数减少输出干扰

## 💡 使用建议

### 最佳体验设置
1. **使用耳机**: 可完全避免回音问题
2. **降低音量**: 使用较低的扬声器音量
3. **保持距离**: 麦克风与扬声器保持适当距离
4. **清晰发音**: 说话清晰，语速适中

### 问题类型
支持询问Seeed Studio相关产品信息：
- XIAO系列开发板
- Grove传感器模块
- SenseCAP物联网设备
- reComputer边缘计算设备
- 技术文档和使用指南

### 示例对话
```
用户: "你好"
机器人: "你好呀，有什么问题可以问我。"
用户: "介绍一下XIAO系列产品"
机器人: [详细介绍XIAO系列特点和应用]
```

## 🛠️ 故障排除

### 常见问题

**1. 回音问题**
- 症状: 机器人说话时检测到自己的声音
- 解决: 使用耳机或降低扬声器音量

**2. 唤醒词不响应**
- 症状: 说"你好"没有反应
- 解决: 确保发音清晰，检查麦克风工作状态

**3. 语音识别效果差**
- 症状: 语音转文本不准确
- 解决: 在安静环境中使用，说话清晰

**4. 系统响应慢**
- 症状: 处理问题时间过长
- 解决: 确保GPU可用，检查网络连接

### 系统要求
- Linux系统 (已在Ubuntu测试)
- Python 3.10+
- CUDA支持 (推荐)
- 麦克风和扬声器/耳机
- 至少4GB内存

### 依赖检查
```bash
# 检查音频设备
arecord -l
aplay -l

# 检查conda环境
conda list | grep torch
conda list | grep sherpa
```

## 📊 性能指标

- **唤醒检测延迟**: < 1秒
- **语音识别延迟**: 1-2秒
- **TTS生成时间**: 0.3-0.5秒/句
- **对话结束检测**: 1-2秒
- **内存使用**: ~1.5GB (包含模型)

## 🔄 更新日志

### v1.0 - 2024.01
- ✅ 基础语音识别和TTS功能
- ✅ 唤醒词检测
- ✅ 基于FAISS的知识问答

### v1.1 - 2024.01
- ✅ 修复音频回音问题
- ✅ 优化对话结束时间
- ✅ 添加防重复处理机制
- ✅ 提升实时性体验

## 📞 技术支持

如果遇到问题，请检查：
1. 所有依赖是否正确安装
2. 音频设备是否正常工作
3. 模型文件是否完整
4. 系统资源是否充足

建议在安静环境中使用，并考虑使用耳机获得最佳体验。
